<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>Tweak our Copy until it's _just_ right
</title>
    <link href="../../stylesheets/site.css" rel="stylesheet" />
    <script src="../../javascripts/site.js"></script>
  </head>
  <body class="page">
    <header class="header">
      <h1 class="header__name">
<a href="../../">          content-authoring
</a>      </h1>


      <nav class="
        header__navigation
        navigation
        
      ">
<a href="../53464a11e615c44bce9fa2494ad98d84f3fb78ab/">              &#8592; Previous
</a>
<a href="../4dc4f0b98c459029b7c57e2671ee7542a98b746d/">              Next &#8594;
</a>      </nav>
    </header>

    <main class="content">
      <details class="accordion content__item">
        <summary class="accordion__summary">
          <div class="accordion__closed">
            <nav class="
              commit-history
              u-db-overflow-y--auto
              u-mb-overflow-x--scroll
            ">
                <a href="../47daff4aeed389fbd952a13ed16244af01500ede/" class="commit-node commit-node--collapsed" title="[SKIP]: Create `git-read` GitHub Action
"></a>
                <a href="../2702ec7345d931b77b59ae6021d11d93c52a9884/" class="commit-node commit-node--collapsed" title="[GENERATED]: Initial Commit
"></a>
                <a href="../09a47f32c1e9a7096e5bd02c19533e36ceb3ca2a/" class="commit-node commit-node--collapsed" title="[GENERATED]: Install ActiveStorage and ActionText
"></a>
                <a href="../6c6533dbbdac50306e018cfa6c5c50edaeb33e81/" class="commit-node commit-node--collapsed" title="[SKIP]: Install TailwindCSS
"></a>
                <a href="../c38868b2f7cc380d2177ecd7d9f5f2b74d240ae2/" class="commit-node commit-node--collapsed" title="Internationalization
"></a>
                <a href="../53464a11e615c44bce9fa2494ad98d84f3fb78ab/" class="commit-node commit-node--collapsed" title="Add style to our page
"></a>
                <a href="./" class="commit-node commit-node--collapsed" title="Tweak our Copy until it's _just_ right
" aria-current="page"></a>
                <a href="../4dc4f0b98c459029b7c57e2671ee7542a98b746d/" class="commit-node commit-node--collapsed" title="Limit Edits to an Authenticated Admin"></a>
                <a href="../9a43f771874f466800135890e83ddf1336607103/" class="commit-node commit-node--collapsed" title="Add support for rendering Rich Text translations"></a>
                <a href="../b582557c458f953fa25eab6d21c372d9c93807a3/" class="commit-node commit-node--collapsed" title="Support Translation Interpolations"></a>
                <a href="../817101a8a19ea0bb50e0a06c4164aac68b217232/" class="commit-node commit-node--collapsed" title="Maintain scrollY across Turbolinks submit redirect"></a>
            </nav>

            <div class="accordion__toggle">
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--desktop"><title>Expand History</title>
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--mobile"><title>Expand History</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>

            </div>
          </div>

          <div class="accordion__opened">
            <div class="accordion__toggle accordion__toggle--fill">
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--desktop"><title>Collapse History</title>
  <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 010 .708L5.707 8l5.647 5.646a.5.5 0 01-.708.708l-6-6a.5.5 0 010-.708l6-6a.5.5 0 01.708 0z" clip-rule="evenodd"></path>
</svg>


              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--mobile"><title>Collapse History</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>

            </div>
          </div>
        </summary>

        <nav class="
          commit-history
          commit-history--full
          u-db-overflow-y--auto
          u-mb-overflow-x--scroll
        ">
<a href="../47daff4aeed389fbd952a13ed16244af01500ede/" class="commit-node commit-node--full">              <p>[SKIP]: Create <code>git-read</code> GitHub Action</p>

</a><a href="../2702ec7345d931b77b59ae6021d11d93c52a9884/" class="commit-node commit-node--full">              <p>[GENERATED]: Initial Commit</p>

</a><a href="../09a47f32c1e9a7096e5bd02c19533e36ceb3ca2a/" class="commit-node commit-node--full">              <p>[GENERATED]: Install ActiveStorage and ActionText</p>

</a><a href="../6c6533dbbdac50306e018cfa6c5c50edaeb33e81/" class="commit-node commit-node--full">              <p>[SKIP]: Install TailwindCSS</p>

</a><a href="../c38868b2f7cc380d2177ecd7d9f5f2b74d240ae2/" class="commit-node commit-node--full">              <p>Internationalization</p>

</a><a href="../53464a11e615c44bce9fa2494ad98d84f3fb78ab/" class="commit-node commit-node--full">              <p>Add style to our page</p>

</a><a href="./" class="commit-node commit-node--full" aria-current="page">              <p>Tweak our Copy until it&#39;s <em>just</em> right</p>

</a><a href="../4dc4f0b98c459029b7c57e2671ee7542a98b746d/" class="commit-node commit-node--full">              <p>Limit Edits to an Authenticated Admin</p>

</a><a href="../9a43f771874f466800135890e83ddf1336607103/" class="commit-node commit-node--full">              <p>Add support for rendering Rich Text translations</p>

</a><a href="../b582557c458f953fa25eab6d21c372d9c93807a3/" class="commit-node commit-node--full">              <p>Support Translation Interpolations</p>

</a><a href="../817101a8a19ea0bb50e0a06c4164aac68b217232/" class="commit-node commit-node--full">              <p>Maintain scrollY across Turbolinks submit redirect</p>

</a>        </nav>
      </details>

      <article class="
        commit-content
        commit-content--double
        content__item
        content__item--grow
      ">
        <section class="commit commit--message">

          <h1 id="tweak-our-copy-until-its-just-right">Tweak our Copy until it&rsquo;s <em>just</em> right</h1>

<p>Let&rsquo;s take an interesting idea, and do it in least surprising way that
we can.</p>

<h2 id="storing-translations-outside-of-config-locales-en-yml">Storing translations outside of <code>config/locales/en.yml</code></h2>

<p>Under the hood, Rails relies on the <a href="https://github.com/ruby-i18n/i18n"><code>ruby-i18n/i18n</code>
gem</a> for determining translations&rsquo; text. Without any
additional configuration, Rails employs an instance of
<code>I18n::Backends::SimpleBackend</code>. In this case, <q>simple</q> is
analogous for reading from the filesystem. The definitions we&rsquo;ve
declared thus far have been made in our project&rsquo;s
<code>config/locales/en.yml</code>. During the application&rsquo;s boot process, the
<code>SimpleBackend</code> reads the contents of that file, parses the YAML into an
instance of a <a href="https://ruby-doc.org/core-2.7.2/Hash.html"><code>Hash</code></a>, and stores it in-memory.</p>

<p>Let&rsquo;s imagine that we&rsquo;d like to change a key&rsquo;s translation.</p>

<blockquote>
<p>No problem! Let&rsquo;s write a new value to that key in the <code>Hash</code>.</p>
</blockquote>

<p>This seems appealing at first, but there are some unfortunate quirks to
consider. Since the value is store in-memory, modifications to that
value would be lost on server restarts, and would be inaccessible from
<em>other</em> server processes.</p>

<p>In the world of <a href="https://en.wikipedia.org/wiki/Scalability#Horizontal_or_scale_out">horizontally scalable
infrastructure</a> and <a href="https://en.wikipedia.org/wiki/Load_balancing_(computing)">load balancing</a>, servers
are restarted constantly, and there are no guarantees that subsequent
requests are served by the same <a href="https://en.wikipedia.org/wiki/Process_(computing)">application process</a>.</p>

<blockquote>
<p>If the value is stored on the filesystem, let&rsquo;s change the
contents of the file.</p>
</blockquote>

<p>Unfortunately, the <code>I18n::Backends::SimpleBackend</code> eager-loads the
contents of the translation file once (and only once) during the
application&rsquo;s boot process, so subsequent changes to the file go
un-read.</p>

<p>Calling <code>I18n::Backend::SimpleBackend#reload!</code> re-parses the YAML file,
but any changes would be local to that server process, which runs afoul
of horizontal scalability and load balancing.</p>

<blockquote>
<p>This sounds like a problem for some sort of data persistence layerâ€¦</p>
</blockquote>

<p>Fortunately, the <a href="https://github.com/ruby-i18n/i18n">ruby-i18n/i18n</a> project provides integrations for
alternate backends. <a href="https://github.com/seanpdoyle/i18n-postgres_json#i18npostgresjsonbackend">I18n::PostgresJson</a> is an <code>I18n::Backend</code>
implementation that reads from and writes to [Postgres JSON and JSONB
columns][]:</p>

<blockquote>
<p><a href="https://www.postgresql.org/about/">PostgreSQL&rsquo;s</a> support for storing objects as <a href="https://www.postgresql.org/docs/9.4/datatype-json.html#DATATYPE-JSON">JSON and JSONB
columns</a>, integrated with <code>ActiveRecord</code> column-aware
models makes it an ideal candidate to store dynamic, editable
application translation text.</p>
</blockquote>
<div class="highlight"><pre class="highlight diff"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/config/initializers/i18n.rb
</span><span class="p">@@ -0,0 +1,8 @@</span>
<span class="gi">+ActiveSupport.on_load :i18n do
+  require "i18n/postgres_json/backend"
+
+  I18n.backend = I18n::Backend::Chain.new(
+    I18n::PostgresJson::Backend.new,
+    I18n.backend,
+  )
+end
</span></code></pre></div>
<p>Within the <a href="#config/initializers/i18n.rb"><code>config/initializers/i18n.rb</code></a>
initializer, establish an order of precedence for resolving a
translation key.</p>

<p>Combine the two backends via a <a href="https://www.rubydoc.info/github/ruby-i18n/i18n/master/I18n/Backend/Chain"><code>I18n::Backends::Chain</code>
instance</a>. The <code>I18n::PostgresJson</code> backend serves as an
editable data source layered on top of the foundational
<code>I18::Backends::Simple</code> defaults:</p>

<p>Outside of configuring the <code>I18n.backend</code> and declaring a correctly
structured database table (included as a <code>I18n::PostgresJson</code>-generated
database migration), there are no additional requirements. We can
continue to transparently call <code>translate</code> in our views, oblivious to
the translations source of data.</p>

<h2 id="the-translation-model">The <code>Translation</code> model</h2>

<p>The <code>I18n::Backend::Chain</code> adheres to the same interface as other
<code>I18n::Backend</code> classes. Its <code>store_translations(locale, data,
**options)</code> implementation adheres to the same order of precedence as
when writing values as its <code>#translate</code> method does when reading values.
In our case, a call to <code>I18n.backend.store_translation</code> will write to
the <code>I18n::PostgresJson::Backend</code> first.</p>

<p>Reading and writing values to and from a database (SQL or otherwise) is
something that Rails (<code>ActiveModel</code> and <code>ActiveRecord</code>, specifically)
excels at.</p>

<p>This commit introduces the <code>Translation</code> class. It&rsquo;s a model class that
<em>is not</em> backed by <code>ActiveRecord::Base</code>. The <code>I18n.backend</code> instance
provides a means of writing to the correct data source with the exact
structure needed. With this access to this method, there&rsquo;s no value in
interfacing directly with PostgreSQL via <code>ActiveRecord</code>. However, there
is value in an <code>ActiveRecord</code>-like interface for reading, writing, and
validating attributes. To get the best of both worlds, the <code>Translation</code>
class mixes in the <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Model.html"><code>ActiveModel::Model</code></a> and
<a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Attributes/ClassMethods.html"><code>ActiveModel::Attributes</code></a> modules.</p>

<p>The data integrity of our translations is crucial. To preserve that
integrity, the <code>Translation</code> model declares several <code>ActiveModel</code>
validations.</p>

<p>For example, reject <code>nil</code> or empty values. Since the PostgresSQL-backed
translations are layer <em>on top of</em> the translations declared in the YAML
file, reject any <code>Translation#key</code> value that <em>does not already exist</em>
in our set of resolvable keys.</p>

<p>Once deemed valid, calls to <code>Translation#save</code> will persist the changes
by invoking <code>I18n.backend.store_translations</code> &emdash; with one final
quirk. To keep the scope of our first foray into copyediting tight and
to limit exposure to various Cross-Site Scripting (<abrr
title="Cross-Site Scripting">XSS</abbr>) vulnerabilities, limit the
translations to <em>plain text only</em> by wrapping calls to
<code>Translation#value</code> with calls to  <code>ActionText::Content#to_plain_text</code>
to <strong>strip out any HTML</strong>:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="k">def</span> <span class="nf">value</span>
  <span class="n">content</span> <span class="o">=</span> <span class="no">ActionText</span><span class="o">::</span><span class="no">Content</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="k">super</span><span class="p">)</span>

  <span class="n">content</span><span class="p">.</span><span class="nf">to_plain_text</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="the-translationscontroller-class">The <code>TranslationsController</code> class</h2>

<p>Backed by our <code>I18n::Backends::Chain</code>, our <code>Translation</code> class serves as
a Model  (the <abbr title="Model>M</abbr> in Rails&rsquo;
Model-View-Controller <abbr title="Model-View-Controller">MVC</abbr>)
paradigm. The remaining two-thirds of the work will be done in our
application&rsquo;s View (the <abbr title="View">V</abbr>) and Controller (the
<abbr title="Controller">C</abbr>) layers.</p>

<p>We&rsquo;ll be managing changes to our Model by responding to HTTP requests
that are routed to our Controllers.</p>

<p>The new <code>TranslationsController</code> class draws inspiration from an example
in the <a href="https://github.com/seanpdoyle/i18n-postgres_json#writing-to-the-tables">i18n-postgres_json README file</a> and
transforms <code>locale</code>, <code>key</code>, and <code>value</code> parameters into <code>Translation</code>
instances. Once the model instance is constructed, the controller
attempts to update the translation by calling <code>Translation#save</code>.</p>

<h2 id="the-translations-form-view-partial">The <a href="#app/views/translations/_form.html.erb"><code>translations/form</code></a> View partial</h2>

<p>The final missing piece of the puzzle is our View layer (the <abbr
title="View">V</abbr> of <abbr
title="Model-View-Controller">MVC</abbr>). The <code>&lt;form&gt;</code> element that we
construct submits a <code>POST /translations</code> request with all the
constituent parts of a <code>Translation</code>: its <code>locale</code>, <code>key</code>, and <code>value</code>.</p>

<p>When passed a block, Rails&rsquo; <code>translate</code> helper <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/TranslationHelper.html#method-i-translate">yields the translation
<em>and</em> the fully qualified translation key</a> as <a href="https://ruby-doc.org/core-2.7.2/doc/syntax/calling_methods_rdoc.html#label-Block+Argument">block
arguments</a>.</p>

<p>For example, when calling <code>translate(&quot;.hero.title&quot;)</code> with a block from
the <code>marketings#index</code> template, the value of the <code>key</code> block parameter
is <code>marketings.index.hero.title</code>. When we render our translations using
the &ldquo;lazy&rdquo; keys, we can access their fully-qualified counterparts
through block arguments.</p>

<p>For calls to <code>translate</code> that we want to be able to edit, invoke them as
a call to <code>editable.translate</code>. The <code>editable.translate</code> helper
delegates to an instance of the <code>Editable</code> class, which decorates calls
to <code>#translate</code> so that they accept a block.</p>

<p>Within the block, use the fully qualified translation key to construct a
<code>&lt;form action=&quot;/translations&quot; method=&quot;post&quot;&gt;</code> element that contains the
<code>key</code> encoded as an <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/hidden"><code>&lt;input type=&quot;hidden&quot;&gt;</code> element</a>.</p>

<p>The submission&rsquo;s <code>locale</code> value can be inferred from the <a href="https://edgeguides.rubyonrails.org/i18n.html#managing-the-locale-across-requests">current
request-local value of <code>I18n.locale</code></a>, and is also encoded
as an <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/hidden"><code>&lt;input type=&quot;hidden&quot;&gt;</code> element</a>, invisible to
the user.</p>

<p>Ideally, the <code>&lt;form&gt;</code> elements for <code>value</code> would serve double duty:
presenting an field to edit the translation text when in focus, and
rendering the contents of the translation text otherwise.</p>

<p>Visual parity between those two modes is achievable, but due to the
subtle differences in how CSS rules are applied to certain <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Content_categories#Flow_content">Flow Content
elements</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Content_categories#Form-associated_content">Form-associated Content
elements</a>, it could become tedious to do so.</p>

<p>Luckily, browser support for the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/contenteditable"><code>[contenteditable]</code>
attribute</a> renders controls for editing content in the
same context and styles it&rsquo;s rendered within normally.</p>

<h2 id="trix-powered-rich-text">Trix-powered Rich Text</h2>

<p><a href="https://github.com/basecamp/trix#editing-text-programmatically">Trix is <q cite="https://github.com/basecamp/trix#trix">a Rich Text
Editor for Everyday Writing</q></a>. It serves as a progressive
enhancement to <code>[contenteditable]</code>, and is a tool under the Ruby on
Rails umbrella <a href="https://edgeguides.rubyonrails.org/6_0_release_notes.html#action-text">since the introduction of the ActionText portion of the
framework</a>.</p>

<p>While Trix is a fully-featured, HTML-capable <dfn id="wysiwyg">What you
See is What you Get (<abbr title="What you See is What you
Get">WYSIWYG</abbr>) editor</dfn>, it&rsquo;s utility comes in the form its
ability to edit already styled content in-context.</p>

<p>Under the hood, <a href="https://edgeapi.rubyonrails.org/classes/ActionText/TagHelper.html#method-i-rich_text_area_tag">calls to <code>rich_text_area_tag</code></a>
produce a <code>&lt;trix-editor&gt;</code> element along with a corresponding <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/hidden"><code>&lt;input
type=&quot;hidden&quot;&gt;</code> element</a> that serves as its form-local
value storage.</p>

<p>On initialization, <code>&lt;trix-editor&gt;</code> elements construct their own
<code>&lt;trix-toolbar&gt;</code> elements to wrap a collection of <code>&lt;button&gt;</code> elements
that are wired-up to modify the <code>&lt;trix-editor&gt;</code> selected contents.</p>

<p>In our use case, we <em>don&rsquo;t</em> want to support anything more sophisticated
than plain text, so we add <code>trix-toolbar</code>-specific CSS rules to style
those elements with <code>display: none;</code>.</p>

<p>It&rsquo;s important that we don&rsquo;t <em>entirely</em> disable the <code>&lt;trix-toolbar&gt;</code>
element, since there are two custom actions we&rsquo;d like to support:
canceling an edit and saving an edit. To implement these actions, we&rsquo;ll
declare the <code>&lt;button&gt;</code> elements in the <a href="#app/views/translations/_form.html.erb"><code>translations/form</code> partial&rsquo;s
HTML</a> as descendants of the
<code>&lt;trix-toolbar&gt;</code> element, and ensure that the <code>&lt;trix-editor
toolbar=&quot;...&quot;&gt;</code> attribute references the <code>&lt;trix-toolbar id=&quot;...&quot;&gt;</code>
attribute. On the initial page load, ensure the toolbar is hidden by
declaring it with the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/hidden"><code>[hidden]</code> attribute</a>.</p>

<p>To handle interactions withing the <code>&lt;trix-editor&gt;</code> element and its
<code>&lt;trix-toolbar&gt;</code>, declare the <a href="#app/javascript/controllers/trix_form_controller.js"><code>trix-form</code> Stimulus
Controller</a>, and
ensure that our <a href="https://stimulusjs.org/reference/controllers#identifiers"><code>&lt;form&gt;</code> element declares it as part of its
<code>[data-controller=&quot;trix-form&quot;]</code> attribute</a>.</p>

<p>When <a href="https://stimulusjs.org/reference/lifecycle-callbacks#connection">the controller attaches behavior to the <code>&lt;form&gt;</code>
element</a>, ensure that the <code>&lt;trix-toolbar&gt;</code> is visually hidden
by ensuring it declares <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/hidden"><code>hidden = true</code></a>.</p>

<p>To declare the rest of its behavior, build the <code>&lt;form&gt;</code> element with
various <a href="https://stimulusjs.org/reference/actions">Stimulus-specific <code>data-action</code> values</a>:</p>
<div class="highlight"><pre class="highlight diff"><code><span class="gd">--- /dev/null
</span><span class="gi">+++ b/app/views/translations/_form.html.erb
</span><span class="p">@@ -0,0 +1,44 @@</span>
<span class="gi">+&lt;%= form_with model: translation, class: "relative", data: {
+  controller: "trix-form",
+  action: "
+    trix-file-accept-&gt;trix-form#reject
+    trix-focus@document-&gt;trix-form#dismissDismissUnlessFocused
+    click@document-&gt;trix-form#dismissUnlessContained
+    focusout-&gt;trix-form#dismissUnlessContained
+    reset-&gt;trix-form#dismiss
+  "
+} do |form| %&gt;
</span></code></pre></div>
<p>Each line routes a DOM event to an action declared in the <code>trix-form</code>
controller:</p>
<div class="highlight"><pre class="highlight diff"><code><span class="gi">+    trix-focus@document-&gt;trix-form#dismissDismissUnlessFocused
</span></code></pre></div>
<p>The <code>@document</code> portion of the action routing declaration declares a
<a href="https://github.com/basecamp/trix/tree/1.3.0#observing-editor-changes"><code>trix-focus</code> event listener</a> on the <code>document</code>, instead of
the <code>&lt;form&gt;</code> element. This means that whenever any of the
<code>&lt;trix-editor&gt;</code> elements receive focus, <em>all</em> of the <code>trix-form</code>
controllers will respond to the event. This means that we can hide all
the <code>trix-toolbar</code> elements <em>except for the editor with focus</em> within a
single action declaration.</p>
<div class="highlight"><pre class="highlight diff"><code><span class="gi">+    trix-file-accept-&gt;trix-form#reject
</span></code></pre></div>
<p>This <code>trix-file-accept</code> event listener routes events to an action that
invokes <a href="https://developer.mozilla.org/en-US/docs/Web/API/Event/preventDefault"><code>event.preventDefault()</code></a>, effectively
cancelling any file attachment attempts.</p>

<p>The other routing declarations will dismiss the toolbar when the
<code>&lt;form&gt;</code> element is reset (via the <code>reset</code> event), focus
leaves the editor (via the <code>focusout</code> event), or a mouse <code>click</code> event
fires anywhere outside of the <code>&lt;trix-editor&gt;</code> or <code>&lt;trix-toolbar&gt;</code>
element.</p>

<h2 id="testing-the-interactions">Testing the interactions</h2>

<p>For each concept introduced here (i.e. the <code>Translation</code> class, the
<code>TranslationsController</code> class, the <code>translations/form</code> view partial,
and the Trix editor integration) is tested in turn at its corresponding
layer of the <a href="https://martinfowler.com/articles/practical-test-pyramid.html#TheTestPyramid">Testing Pyramid</a>:</p>

<p><img src="https://martinfowler.com/articles/practical-test-pyramid/testPyramid.png" alt="The Test Pyramid" /></p>

<p>The <code>Translation</code> model is covered by a unit test, the
<code>TranslationsController</code> is covered by a <a href="https://edgeapi.rubyonrails.org/">service-level integration
test</a>, and the <code>translations/form</code> view
partial and the rest of the Trix behavior is covered by an <a href="https://edgeguides.rubyonrails.org/testing.html#system-testing">end-to-end
System Test</a>.</p>

<p>In order to ensure that each test is run with test-specific data, the
<code>#with_translations</code> test helper accepts a set of translations and a
block, and ensures that those translations are only available <em>within
the block&rsquo;s scope of execution</em>.</p>

<h1 id="our-progress-so-far">Our progress so far</h1>

<p>I wonder, what would it take to edit HTML translations?</p>

<h2 id="desktop">Desktop</h2>

<p><img src="https://user-images.githubusercontent.com/2575027/95688393-d1c2a280-0bd7-11eb-948d-412787e328e2.gif" alt="editing translation in desktop dimensions" /></p>

<h2 id="mobile">Mobile</h2>

<p><img src="https://user-images.githubusercontent.com/2575027/95688395-d1c2a280-0bd7-11eb-9f69-dce67d1dbb7b.gif" alt="editing translation in mobile dimensions" /></p>

        </section>

          <aside class="commit commit--diff commit--long-content">
              <details
  id="Gemfile"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse Gemfile</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand Gemfile</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      Gemfile
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/Gemfile b/Gemfile
index 025dcb7..4b865c1 100644
</span><span class="gd">--- a/Gemfile
</span><span class="gi">+++ b/Gemfile
</span><span class="p">@@ -29,6 +29,8 @@</span> gem 'jbuilder', '~&gt; 2.7'
 # Reduces boot times through caching; required in config/boot.rb
 gem 'bootsnap', '&gt;= 1.4.4', require: false
 
<span class="gi">+gem 'i18n-postgres_json', '~&gt; 0.1.0'
+
</span> group :development, :test do
   # Call 'byebug' anywhere in the code to stop execution and get a debugger console
   gem 'byebug', platforms: [:mri, :mingw, :x64_mingw]
</code></pre></div></details>

              <details
  id="Gemfile.lock"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse Gemfile.lock</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand Gemfile.lock</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      Gemfile.lock
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/Gemfile.lock b/Gemfile.lock
index 49c5023..e699371 100644
</span><span class="gd">--- a/Gemfile.lock
</span><span class="gi">+++ b/Gemfile.lock
</span><span class="p">@@ -130,6 +130,9 @@</span> GEM
       activesupport (&gt;= 4.2.0)
     i18n (1.8.5)
       concurrent-ruby (~&gt; 1.0)
<span class="gi">+    i18n-postgres_json (0.1.0)
+      activerecord (&gt;= 4.2.0)
+      pg
</span>     jbuilder (2.10.1)
       activesupport (&gt;= 5.0.0)
     listen (3.2.1)
<span class="p">@@ -220,6 +223,7 @@</span> DEPENDENCIES
   bootsnap (&gt;= 1.4.4)
   byebug
   capybara (&gt;= 3.26)
<span class="gi">+  i18n-postgres_json (~&gt; 0.1.0)
</span>   jbuilder (~&gt; 2.7)
   listen (~&gt; 3.2)
   pg (~&gt; 1.1)
</code></pre></div></details>

              <details
  id="app/controllers/translations_controller.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/controllers/translations_controller.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/controllers/translations_controller.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/controllers/translations_controller.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/controllers/translations_controller.rb b/app/controllers/translations_controller.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..9f85449
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/app/controllers/translations_controller.rb
</span><span class="p">@@ -0,0 +1,17 @@</span>
<span class="gi">+class TranslationsController &lt; ApplicationController
+  def create
+    translation = Translation.new(translation_params)
+
+    if translation.save
+      redirect_back fallback_location: root_url
+    else
+      head :unprocessable_entity
+    end
+  end
+
+  private
+
+  def translation_params
+    params.require(:translation).permit(:locale, :key, :value)
+  end
+end
</span></code></pre></div></details>

              <details
  id="app/helpers/application_helper.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/helpers/application_helper.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/helpers/application_helper.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/helpers/application_helper.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/helpers/application_helper.rb b/app/helpers/application_helper.rb
index de6be79..347c95d 100644
</span><span class="gd">--- a/app/helpers/application_helper.rb
</span><span class="gi">+++ b/app/helpers/application_helper.rb
</span><span class="p">@@ -1,2 +1,20 @@</span>
 module ApplicationHelper
<span class="gi">+  def editable
+    Editable.new(self)
+  end
+
+  class Editable
+    def initialize(template)
+      @template = template
+    end
+
+    def translate(key, locale: I18n.locale, **options)
+      @template.translate key, **options do |value, full_key|
+        translation = Translation.new(locale: locale, key: full_key, value: value)
+
+        @template.render translation
+      end
+    end
+  end
+  private_constant :Editable
</span> end
</code></pre></div></details>

              <details
  id="app/javascript/controllers/trix_form_controller.js"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/javascript/controllers/trix_form_controller.js</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/javascript/controllers/trix_form_controller.js</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/javascript/controllers/trix_form_controller.js
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/javascript/controllers/trix_form_controller.js b/app/javascript/controllers/trix_form_controller.js
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..9156e6a
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/app/javascript/controllers/trix_form_controller.js
</span><span class="p">@@ -0,0 +1,39 @@</span>
<span class="gi">+import { Controller } from "stimulus"
+
+export default class extends Controller {
+  static targets = [ "editor" ]
+
+  connect() {
+    this.dismiss()
+  }
+
+  showToolbar({ target }) {
+    this.toggleToolbar({ visible: target === this.editorTarget })
+  }
+
+  dismissDismissUnlessFocused({ target: { toolbarElement } }) {
+    this.toggleToolbar({ visible: toolbarElement === this.toolbarTarget })
+  }
+
+  dismissUnlessContained({ target }) {
+    if (this.element.contains(target)) return
+
+    this.dismiss()
+  }
+
+  dismiss() {
+    this.toggleToolbar({ visible: false })
+  }
+
+  reject(event) {
+    event.preventDefault()
+  }
+
+  toggleToolbar({ visible }) {
+    this.toolbarTarget.hidden = !visible
+  }
+
+  get toolbarTarget() {
+    return this.editorTarget.toolbarElement
+  }
+}
</span></code></pre></div></details>

              <details
  id="app/javascript/packs/application.css"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/javascript/packs/application.css</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/javascript/packs/application.css</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/javascript/packs/application.css
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/javascript/packs/application.css b/app/javascript/packs/application.css
index 76fcadc..65c8d71 100644
</span><span class="gd">--- a/app/javascript/packs/application.css
</span><span class="gi">+++ b/app/javascript/packs/application.css
</span><span class="p">@@ -1,3 +1,24 @@</span>
<span class="gi">+@import "trix/dist/trix.css";
</span> @import "tailwindcss/base";
 @import "tailwindcss/components";
 @import "tailwindcss/utilities";
<span class="gi">+
+trix-toolbar {
+  @apply absolute left-0 right-0 transform -translate-y-full z-50;
+}
+
+trix-toolbar .trix-button {
+  @apply bg-white;
+}
+
+trix-toolbar .trix-button-group {
+  @apply mb-auto;
+}
+
+trix-toolbar .trix-button-row--end {
+  @apply justify-end;
+}
+
+trix-toolbar .trix-button-group--block-tools {
+  @apply hidden;
+}
</span></code></pre></div></details>

              <details
  id="app/models/translation.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/models/translation.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/models/translation.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/models/translation.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/models/translation.rb b/app/models/translation.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..0d3cfd9
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/app/models/translation.rb
</span><span class="p">@@ -0,0 +1,42 @@</span>
<span class="gi">+class Translation
+  include ActiveModel::Model
+  include ActiveModel::Attributes
+
+  attribute :locale, :string, default: -&gt; { I18n.locale }
+  attribute :key, :string
+  attribute :value, :string
+
+  validates :value, presence: true
+  validate { errors.add(:key, :invalid) if new_record? }
+
+  def id
+    key
+  end
+
+  def value
+    content = ActionText::Content.new(super)
+
+    content.to_plain_text
+  end
+
+  def new_record?
+    I18n.translate(key, locale: locale, default: "").blank?
+  end
+
+  def save
+    if valid?
+      I18n.backend.store_translations(locale, { key =&gt; value })
+      true
+    else
+      false
+    end
+  end
+
+  def to_key
+    [key.gsub(".", "_")]
+  end
+
+  def to_s
+    value
+  end
+end
</span></code></pre></div></details>

              <details
  id="app/views/marketings/index.html.erb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/views/marketings/index.html.erb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/views/marketings/index.html.erb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/views/marketings/index.html.erb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/views/marketings/index.html.erb b/app/views/marketings/index.html.erb
index b00ee65..390c2a3 100644
</span><span class="gd">--- a/app/views/marketings/index.html.erb
</span><span class="gi">+++ b/app/views/marketings/index.html.erb
</span><span class="p">@@ -5,7 +5,7 @@</span>
 &lt;div class="container mx-auto h-screen"&gt;
   &lt;div class="text-center px-3 lg:px-0"&gt;
     &lt;h1 class="my-4 text-2xl md:text-3xl lg:text-5xl font-black leading-tight"&gt;
<span class="gd">-      &lt;%= translate(".hero.title") %&gt;
</span><span class="gi">+      &lt;%= editable.translate(".hero.title") %&gt;
</span>     &lt;/h1&gt;
 
     &lt;div class="leading-normal text-gray-800 text-base md:text-xl lg:text-2xl mb-8"&gt;
<span class="p">@@ -53,7 +53,7 @@</span>
 &lt;section class="bg-white border-b py-12 "&gt;
   &lt;div class="container mx-auto flex flex-wrap items-center justify-between pb-12"&gt;
     &lt;h2 class="w-full my-2 text-xl font-black leading-tight text-center text-gray-800 lg:mt-8"&gt;
<span class="gd">-      &lt;%= translate(".customers.title") %&gt;
</span><span class="gi">+      &lt;%= editable.translate(".customers.title") %&gt;
</span>     &lt;/h2&gt;
 
     &lt;div class="w-full mb-4"&gt;
<span class="p">@@ -105,7 +105,7 @@</span>
 &lt;section class="bg-gray-100 border-b py-8"&gt;
   &lt;div class="container max-w-5xl mx-auto m-8"&gt;
     &lt;h2 class="w-full my-2 text-5xl font-black leading-tight text-center text-gray-800"&gt;
<span class="gd">-      &lt;%= translate(".value_proposition.title") %&gt;
</span><span class="gi">+      &lt;%= editable.translate(".value_proposition.title") %&gt;
</span>     &lt;/h2&gt;
 
     &lt;div class="w-full mb-4"&gt;
<span class="p">@@ -147,7 +147,7 @@</span>
 &lt;section class="bg-white border-b py-8"&gt;
   &lt;div class="container mx-auto flex flex-wrap pt-4 pb-12"&gt;
     &lt;h2 class="w-full my-2 text-5xl font-black leading-tight text-center text-gray-800"&gt;
<span class="gd">-      &lt;%= translate(".features.title") %&gt;
</span><span class="gi">+      &lt;%= editable.translate(".features.title") %&gt;
</span>     &lt;/h2&gt;
     &lt;div class="w-full mb-4"&gt;
       &lt;div class="h-1 mx-auto bg-gradient-to-r from-purple-300 to-indigo-300 w-64 opacity-25 my-0 py-0 rounded-t"&gt;&lt;/div&gt;
<span class="p">@@ -183,7 +183,7 @@</span>
 &lt;section class="bg-gray-100 py-8"&gt;
   &lt;div class="container mx-auto px-2 pt-4 pb-12 text-gray-800"&gt;
     &lt;h2 class="w-full my-2 text-5xl font-black leading-tight text-center text-gray-800"&gt;
<span class="gd">-      &lt;%= translate(".pricing.title") %&gt;
</span><span class="gi">+      &lt;%= editable.translate(".pricing.title") %&gt;
</span>     &lt;/h2&gt;
     &lt;div class="w-full mb-4"&gt;
       &lt;div class="h-1 mx-auto bg-gradient-to-r from-purple-300 to-indigo-300 w-64 opacity-25 my-0 py-0 rounded-t"&gt;&lt;/div&gt;
<span class="p">@@ -263,14 +263,14 @@</span>
 
 &lt;section class="bg-gradient-to-r from-purple-300 to-indigo-300 w-full mx-auto text-center pt-6 pb-12"&gt;
   &lt;h2 class="w-full my-2 text-5xl font-black leading-tight text-center text-white"&gt;
<span class="gd">-    &lt;%= translate(".call_to_action.title") %&gt;
</span><span class="gi">+    &lt;%= editable.translate(".call_to_action.title") %&gt;
</span>   &lt;/h2&gt;
   &lt;div class="w-full mb-4"&gt;
     &lt;div class="h-1 mx-auto bg-white w-1/6 opacity-25 my-0 py-0 rounded-t"&gt;&lt;/div&gt;
   &lt;/div&gt;
 
   &lt;h3 class="my-4 text-3xl font-extrabold"&gt;
<span class="gd">-    &lt;%= translate(".call_to_action.content") %&gt;
</span><span class="gi">+    &lt;%= editable.translate(".call_to_action.content") %&gt;
</span>   &lt;/h3&gt;
 
   &lt;button class="mx-auto lg:mx-0 hover:underline bg-gradient-to-r from-orange-300 to-orange-400 text-gray-800 font-extrabold rounded py-4 px-8 shadow opacity-75 my-6"&gt;
</code></pre></div></details>

              <details
  id="app/views/translations/_form.html.erb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/views/translations/_form.html.erb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/views/translations/_form.html.erb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/views/translations/_form.html.erb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/views/translations/_form.html.erb b/app/views/translations/_form.html.erb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..1e848bd
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/app/views/translations/_form.html.erb
</span><span class="p">@@ -0,0 +1,44 @@</span>
<span class="gi">+&lt;%= form_with model: translation, class: "relative", data: {
+  controller: "trix-form",
+  action: "
+    trix-file-accept-&gt;trix-form#reject
+    trix-focus@document-&gt;trix-form#dismissDismissUnlessFocused
+    click@document-&gt;trix-form#dismissUnlessContained
+    focusout-&gt;trix-form#dismissUnlessContained
+    reset-&gt;trix-form#dismiss
+  "
+} do |form| %&gt;
+  &lt;%= form.hidden_field :locale %&gt;
+  &lt;%= form.hidden_field :key %&gt;
+
+  &lt;trix-toolbar id="&lt;%= dom_id(translation, :toolbar) %&gt;" hidden&gt;
+    &lt;div class="trix-button-row trix-button-row--end"&gt;
+      &lt;span class="trix-button-group"&gt;
+        &lt;% tag.with_options class: "trix-button trix-button--icon", tabindex: -1 do |trix| %&gt;
+          &lt;%= trix.button type: :submit, title: "Save" do %&gt;
+            &lt;svg class="text-green-500" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"&gt;
+              &lt;title&gt;Save&lt;/title&gt;
+              &lt;path stroke="none" d="M0 0h24v24H0z" fill="none"/&gt;
+              &lt;path d="M5 12l5 5l10 -10" /&gt;
+            &lt;/svg&gt;
+          &lt;% end %&gt;
+
+          &lt;%= trix.button type: :reset, title: "Cancel" do %&gt;
+            &lt;svg class="text-red-500" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"&gt;
+              &lt;title&gt;Cancel&lt;/title&gt;
+              &lt;path stroke="none" d="M0 0h24v24H0z" fill="none"/&gt;
+              &lt;line x1="18" y1="6" x2="6" y2="18" /&gt;
+              &lt;line x1="6" y1="6" x2="18" y2="18" /&gt;
+            &lt;/svg&gt;
+          &lt;% end %&gt;
+        &lt;% end %&gt;
+      &lt;/span&gt;
+    &lt;/div&gt;
+  &lt;/trix-toolbar&gt;
+
+  &lt;%= rich_text_area_tag "translation[value]", translation.value,
+    class: "outline-none focus:shadow-outline min-h-0 border-0 p-0",
+    aria: { label: translation.key },
+    data: { trix_form_target: "editor" },
+    toolbar: dom_id(translation, :toolbar) %&gt;
+&lt;% end %&gt;
</span></code></pre></div></details>

              <details
  id="app/views/translations/_translation.html.erb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/views/translations/_translation.html.erb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/views/translations/_translation.html.erb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/views/translations/_translation.html.erb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/views/translations/_translation.html.erb b/app/views/translations/_translation.html.erb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..4dd9a18
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/app/views/translations/_translation.html.erb
</span><span class="p">@@ -0,0 +1 @@</span>
<span class="gi">+&lt;%= render "translations/form", translation: translation %&gt;
</span></code></pre></div></details>

              <details
  id="config/initializers/i18n.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse config/initializers/i18n.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand config/initializers/i18n.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      config/initializers/i18n.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/config/initializers/i18n.rb b/config/initializers/i18n.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..502d451
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/config/initializers/i18n.rb
</span><span class="p">@@ -0,0 +1,8 @@</span>
<span class="gi">+ActiveSupport.on_load :i18n do
+  require "i18n/postgres_json/backend"
+
+  I18n.backend = I18n::Backend::Chain.new(
+    I18n::PostgresJson::Backend.new,
+    I18n.backend,
+  )
+end
</span></code></pre></div></details>

              <details
  id="config/routes.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse config/routes.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand config/routes.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      config/routes.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/config/routes.rb b/config/routes.rb
index 76693b1..9782e5e 100644
</span><span class="gd">--- a/config/routes.rb
</span><span class="gi">+++ b/config/routes.rb
</span><span class="p">@@ -1,4 +1,6 @@</span>
 Rails.application.routes.draw do
   # For details on the DSL available within this file, see https://guides.rubyonrails.org/routing.html
<span class="gi">+  resources :translations, only: :create
+
</span>   root to: "marketings#index"
 end
</code></pre></div></details>

              <details
  id="db/migrate/20201002043200_create_i18n_postgres_json_backend_translations.i18n_postgres_json_engine.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse db/migrate/20201002043200_create_i18n_postgres_json_backend_translations.i18n_postgres_json_engine.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand db/migrate/20201002043200_create_i18n_postgres_json_backend_translations.i18n_postgres_json_engine.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      db/migrate/20201002043200_create_i18n_postgres_json_backend_translations.i18n_postgres_json_engine.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/db/migrate/20201002043200_create_i18n_postgres_json_backend_translations.i18n_postgres_json_engine.rb b/db/migrate/20201002043200_create_i18n_postgres_json_backend_translations.i18n_postgres_json_engine.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..7bfb922
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/db/migrate/20201002043200_create_i18n_postgres_json_backend_translations.i18n_postgres_json_engine.rb
</span><span class="p">@@ -0,0 +1,12 @@</span>
<span class="gi">+# This migration comes from i18n_postgres_json_engine (originally 20200409133306)
+class CreateI18nPostgresJsonBackendTranslations &lt; ActiveRecord::Migration[4.2]
+  def change
+    create_table :i18n_postgres_json_backend_translations do |t|
+      t.string :locale, null: false
+      t.json :translations, null: false, default: {}
+      t.timestamps null: false
+
+      t.index :locale, unique: true
+    end
+  end
+end
</span></code></pre></div></details>

              <details
  id="db/schema.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse db/schema.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand db/schema.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      db/schema.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/db/schema.rb b/db/schema.rb
index 2daeec1..e0a4e4a 100644
</span><span class="gd">--- a/db/schema.rb
</span><span class="gi">+++ b/db/schema.rb
</span><span class="p">@@ -10,7 +10,7 @@</span>
 #
 # It's strongly recommended that you check this file into your version control system.
 
<span class="gd">-ActiveRecord::Schema.define(version: 2020_10_01_040643) do
</span><span class="gi">+ActiveRecord::Schema.define(version: 2020_10_02_043200) do
</span> 
   # These are extensions that must be enabled in order to support this database
   enable_extension "plpgsql"
<span class="p">@@ -53,6 +53,14 @@</span> ActiveRecord::Schema.define(version: 2020_10_01_040643) do
     t.index ["blob_id", "variation_digest"], name: "index_active_storage_variant_records_uniqueness", unique: true
   end
 
<span class="gi">+  create_table "i18n_postgres_json_backend_translations", id: :serial, force: :cascade do |t|
+    t.string "locale", null: false
+    t.json "translations", default: {}, null: false
+    t.datetime "created_at", null: false
+    t.datetime "updated_at", null: false
+    t.index ["locale"], name: "index_i18n_postgres_json_backend_translations_on_locale", unique: true
+  end
+
</span>   add_foreign_key "active_storage_attachments", "active_storage_blobs", column: "blob_id"
   add_foreign_key "active_storage_variant_records", "active_storage_blobs", column: "blob_id"
 end
</code></pre></div></details>

              <details
  id="test/controllers/marketings_controller_test.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/controllers/marketings_controller_test.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/controllers/marketings_controller_test.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/controllers/marketings_controller_test.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/controllers/marketings_controller_test.rb b/test/controllers/marketings_controller_test.rb
index 6850026..6e05b54 100644
</span><span class="gd">--- a/test/controllers/marketings_controller_test.rb
</span><span class="gi">+++ b/test/controllers/marketings_controller_test.rb
</span><span class="p">@@ -3,13 +3,19 @@</span> require "test_helper"
 class MarketingsControllerTest &lt; ActionDispatch::IntegrationTest
   include ActionView::Helpers::TranslationHelper
 
<span class="gd">-  test "#index renders marketing copy" do
</span><span class="gi">+  test "#index renders editors for copy" do
</span>     get root_path
 
     assert_response :success
     with_options scope: [:marketings, :index, :hero] do |i18n|
       assert_select "title", text: i18n.translate(:title)
<span class="gd">-      assert_select "h1", text: i18n.translate(:title)
</span><span class="gi">+      assert_trix_editor "translation[value]", i18n.translate(:title)
</span>     end
   end
<span class="gi">+
+  private
+
+  def assert_trix_editor(name, value)
+    assert_select %{input[type="hidden"][name="#{name}"]:match("value", ?) ~ trix-editor}, value
+  end
</span> end
</code></pre></div></details>

              <details
  id="test/controllers/translations_controller_test.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/controllers/translations_controller_test.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/controllers/translations_controller_test.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/controllers/translations_controller_test.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/controllers/translations_controller_test.rb b/test/controllers/translations_controller_test.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..335dd55
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/test/controllers/translations_controller_test.rb
</span><span class="p">@@ -0,0 +1,24 @@</span>
<span class="gi">+require "test_helper"
+
+class TranslationsControllerTest &lt; ActionDispatch::IntegrationTest
+  test "#create with a valid Translation persists it to the I18n backend" do
+    with_translations en: { key: "value" } do
+      post translations_path, params: {
+        translation: { locale: :en, key: "key", value: "new value" }
+      }
+
+      assert_redirected_to root_url
+      assert_equal "new value", I18n.translate(:key)
+    end
+  end
+
+  test "#create with an valid Translation responds with an error" do
+    with_translations en: {} do
+      post translations_path, params: {
+        translation: { locale: :en, key: "missing", value: "" }
+      }
+
+      assert_response :unprocessable_entity
+    end
+  end
+end
</span></code></pre></div></details>

              <details
  id="test/models/translation_test.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/models/translation_test.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/models/translation_test.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/models/translation_test.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/models/translation_test.rb b/test/models/translation_test.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..9bae499
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/test/models/translation_test.rb
</span><span class="p">@@ -0,0 +1,93 @@</span>
<span class="gi">+require "test_helper"
+
+class TranslationTest &lt; ActiveSupport::TestCase
+  test "#id returns the translation key" do
+    translation = Translation.new(key: "application.key")
+
+    id = translation.id
+
+    assert_equal "application.key", id
+  end
+
+  test "#key replaces . with _ when building a key Array" do
+    translation = Translation.new(key: "application.key")
+
+    to_key = translation.to_key
+
+    assert_equal ["application_key"], to_key
+  end
+
+  test "#new_record? returns true when there isn't an existing key" do
+    with_translations en: { existing: "value" } do
+      translation = Translation.new(locale: :en, key: "missing")
+
+      assert_predicate translation, :new_record?
+    end
+  end
+
+  test "#new_record? returns false when there is an existing key" do
+    with_translations en: { existing: "value" } do
+      translation = Translation.new(locale: :en, key: "existing")
+
+      assert_not_predicate translation, :new_record?
+    end
+  end
+
+  test "when valid, #save writes to the I18n backend" do
+    with_translations en: { key: "value" } do
+      translation = Translation.new(locale: :en, key: "key", value: "new value")
+
+      saved = translation.save
+
+      assert saved
+      assert_equal "new value", I18n.translate(:key)
+    end
+  end
+
+  test "when invalid, #save does not change the backend" do
+    with_translations en: { key: "value" } do
+      translation = Translation.new(locale: :en, key: "key", value: nil)
+
+      saved = translation.save
+
+      assert_not saved
+      assert_equal "value", I18n.translate(:key)
+    end
+  end
+
+  test "#value strips HTML elements for plain text translations" do
+    translation = Translation.new(key: :plain, value: "&lt;strong&gt;text&lt;/strong&gt;")
+
+    value = translation.value
+
+    assert_equal "text", value
+  end
+
+  test "#to_s returns the value for direct interpolation" do
+    translation = Translation.new(value: "translation text")
+
+    to_s = translation.to_s
+
+    assert_equal "translation text", to_s
+  end
+
+  test "is invalid when the value is empty" do
+    translation = Translation.new(value: "")
+
+    valid = translation.validate
+
+    assert_not valid
+    assert_includes translation.errors, :value
+  end
+
+  test "is invalid when the key is not an existing translation" do
+    with_translations en: { existing: "value" } do
+      translation = Translation.new(locale: :en, key: "missing")
+
+      valid = translation.validate
+
+      assert_not valid
+      assert_includes translation.errors, :key
+    end
+  end
+end
</span></code></pre></div></details>

              <details
  id="test/system/translations_test.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/system/translations_test.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/system/translations_test.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/system/translations_test.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/system/translations_test.rb b/test/system/translations_test.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..c900990
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/test/system/translations_test.rb
</span><span class="p">@@ -0,0 +1,22 @@</span>
<span class="gi">+require "application_system_test_case"
+
+class TranslationsTest &lt; ApplicationSystemTestCase
+  include ActionView::Helpers::TranslationHelper
+
+  test "edit translations" do
+    with_translations en: { marketings: { index: { hero: { title: "Old Hero Title" } } } } do
+      translation = translate("marketings.index.hero.title")
+
+      visit root_path
+      within "h1", text: translation do
+        find(:rich_text_area).click
+        fill_in_rich_text_area with: "New Hero Title"
+        click_on "Save"
+      end
+
+      within "h1", text: "New Hero Title" do
+        assert_no_text translation
+      end
+    end
+  end
+end
</span></code></pre></div></details>

              <details
  id="test/test_helper.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/test_helper.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/test_helper.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/test_helper.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/test_helper.rb b/test/test_helper.rb
index 47b598d..daaef5c 100644
</span><span class="gd">--- a/test/test_helper.rb
</span><span class="gi">+++ b/test/test_helper.rb
</span><span class="p">@@ -10,4 +10,17 @@</span> class ActiveSupport::TestCase
   fixtures :all
 
   # Add more helper methods to be used by all tests here...
<span class="gi">+  def with_translations(translations, &amp;block)
+    overrides = I18n::Backend::Simple.new.tap(&amp;:eager_load!)
+    translations.each { |locale, data| overrides.store_translations(locale, data) }
+
+    *chained, defaults = I18n.backend.backends
+    backend_with_overrides = I18n::Backend::Chain.new(*chained, overrides)
+
+    backend, I18n.backend = I18n.backend, backend_with_overrides
+
+    block.call
+  ensure
+    I18n.backend = backend
+  end
</span> end
</code></pre></div></details>

          </aside>
      </article>
    </main>
  </body>
</html>
